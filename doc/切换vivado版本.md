## 切换默认vivado版本

#### 目的

- 客户vivado版本很多，每次打开很麻烦，如果能一键切换也非常方便
- 这个编译依赖于默认的vivado版本

#### 思路

- 在scripts里面写一些关于版本切换的ps1文件，需要的时候，直接执行就可以了

#### 具体实现

- 首先说一点，可能目前的版本只能适用我自己的电脑。不是通用的，需要学方法。

- 脚本要跑起来，有需要注意的点，powershell要给权限，如果不是复制的内容，是直接拷贝的脚本，会提示数字签名啥的，需要在属性里面解除锁定。

  ##### 双击打开默认vivado

  - 这个需要设置注册表，设置一个变量切换版本就可以了，注册表路径

    ```
    HKEY_CLASSES_ROOT\Vivado.Project.1\Shell\Open\Command
    ```

  - 修改路径里面的多版本的版本号，如**2018.3**

    ```
    D:\\xilinx\rundir\Vivado\2018.3\bin\unwrapped\win64.o\vvgl.exe D:\\xilinx\rundir\Vivado\2018.3\bin\vivado.bat "%1"
    ```

  - 这里更多的时间花在脚本的调试上，也踩过不少坑。emm，就是没事别动注册表，保险！

  ##### 在cmd或者powershell默认打开vivado
  
  - 相比较而言，上面只是方便打开工程，下面这个才是我们需要的。这个关系到我们make命令调用的vivado。
  
  - 这个就只需要修改环境变量，就可以了。思路非常简单，但是实现有点恼人。可以同上一样修改注册表，但是刷新非常麻烦。
  
  - 这个可以刷新组策略但是管理员和普通用户是分开的，因为上面必须开启管理员权限，导致管理员下，vivado切换正常，普通用户基本用不了。
  
    ```
    gpupdate /force /wait:0  
    ```
  
  - 这个方法有效，但是文件管理器会直接关掉，用户体验非常差，但是很有效。
  
    ```
    Stop-Process -Name explorer -Force  
    ```
  
  - 还有一种直接修改环境变量的方法，首先要注意，直接设置环境变量肯定不行，因为关闭终端之后基本没用，而且分用户变量和系统变量，用户变量设置还是好更改的，但是注意一下，他优先级没有系统变量高，导致有一个问题是什么，就是之前的人设置了系统变量的vivado，那么你设置用户变量就一点用都没有。然后就是系统变量，直接在path里面设置路径就好了，用%vivado%去替换，我的思路不是很好，所以先用最简单且能实现的方式做了。

#### 优化

- 更好的做法，是检测所有的vivado版本的路径，然后再make里面切换。操作步骤更少，灵活度高。